<div class="list-group job-posts">
    <% @job_posts.each do |job_post| %>
      <ul class="list-group">
        <li class="list-group-item">
        <% if job_post.rejected? %>
          <h2 class="list-group-item-heading"><strike><%= job_post.title %></strike></h2>
        <% else %>
          <h2 class="list-group-item-heading"><%= link_to job_post.title, job_post %></h2>
        <% end %>

        <% if job_post.active? %>
          <span title="<%= job_post.expires_at.strftime("%a, %B %d %Y") %>" ><%= expiry_info(job_post) %></span>
        <% else %>
            <%= form_tag(charge_job_post_path(job_post)) do %>
              <script src="https://checkout.stripe.com/checkout.js"></script>
              <button id="publish-button" class="btn btn-primary">Publish</button>
              <script>
                var handler = StripeCheckout.configure({
                  key: 'pk_test_557yys5VpADpjbB4RIpcwg62',
                  image: '/square-image.png',
                  token: function(token, args) {
                    // Use the token to create the charge with a server-side script.
                    // You can access the token ID with `token.id`
                  }
                });

                document.getElementById('publish-button').addEventListener('click', function(e) {
                  // Open Checkout with further options
                  handler.open({
                    name: 'Ladies Learning Code',
                    description: 'Job Post for 30 days ($30.00)',
                    amount: 3000,
                    currency: 'CAD',
                    email: "<%= current_user.email %>"
                  });
                  e.preventDefault();
                });
              </script>
            </form>
            <% end %>
        <% end %>
        </li>
      </ul>
    <% end %>
</div>
